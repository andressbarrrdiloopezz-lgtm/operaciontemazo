<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ OPERACI√ìN TEMAZO - TORNEO</title>
    <style>
        body { background: #020202; color: #fff; font-family: 'Courier New', monospace; display: flex; justify-content: center; padding: 20px; }
        .player-container { background: #000; padding: 25px; border: 4px solid #1DB954; border-radius: 20px; box-shadow: 0 0 40px rgba(29, 185, 84, 0.5); width: 100%; max-width: 600px; }
        .neon-line { height: 4px; background: #1DB954; box-shadow: 0 0 20px #1DB954; margin-bottom: 25px; }
        .phase-btn { background: #000; color: #1DB954; border: 2px solid #1DB954; padding: 10px; font-weight: bold; cursor: pointer; box-shadow: 0 0 10px #1DB954; text-transform: uppercase; width: 100%; margin-top: 10px; }
        .phase-btn:hover { background: #1DB954; color: #000; }
        .now-playing { background: #080808; padding: 20px; border: 2px solid #1DB954; border-radius: 15px; text-align: center; margin-bottom: 30px; box-shadow: inset 0 0 15px #1DB954; }
        #video-container { height: 100px; margin-top: 15px; border-radius: 10px; background: #000; border: 1px solid #1DB954; overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; }
        .song-card { background: #000; border: 2px solid #1DB954; margin-bottom: 15px; padding: 20px; border-radius: 15px; }
        .vote-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 10px; margin: 15px 0; }
        .score-input { background: #000; border: 1px solid #1DB954; color: #1DB954; padding: 8px; text-align: center; width: 100%; box-sizing: border-box; }
        .vs-container { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .vs-card { width: 100%; border: 4px solid #1DB954; padding: 25px; background: #0a0a0a; border-radius: 20px; text-align: center; cursor: pointer; box-sizing: border-box; }
        .vs-divider { font-size: 50px; font-weight: bold; color: #fff; text-shadow: 0 0 20px #1DB954; }
        .song-title { font-size: 1.2rem; font-weight: bold; }
        .avg-score { color: #1DB954; font-weight: bold; margin-left: 10px; }
        .setup-section { margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
    </style>
</head>
<body>
    <div class="player-container">
        <div class="header">
            <h1>üöÄ OPERACI√ìN TEMAZO: <span id="fase-nombre">CLASIFICACI√ìN</span></h1>
            <div class="neon-line"></div>
        </div>
        
        <div class="setup-section">
            <label>N¬∫ JURADOS:</label>
            <input type="number" id="viewer-count" value="1" min="1" onchange="actualizarJurados()" style="width: 50px;">
            <button id="next-phase-btn" onclick="cerrarClasificacion()" class="phase-btn" style="width: auto; float: right; margin-top: -5px;">CERRAR CLASIFICACI√ìN</button>
        </div>

        <div class="now-playing">
            <p id="current-song">SELECCIONA UNA CANCI√ìN</p>
            <div id="video-container"></div>
        </div>
        
        <div id="playlist"></div>
    </div>

    <script>
        const canciones = [
            { t: "CANCI√ìN 01", id: "1oc38FdVsra6FIh1xLShwOY3bog-EiT1i", n: [] },
            { t: "CANCI√ìN 02", id: "1w5j3wnnNr4PoUbBypvZqVjBTutuwHqRk", n: [] },
            { t: "CANCI√ìN 03", id: "1Rx3uIl2kIMlweVlC2VQzrbQGGyG1Sbvs", n: [] },
            { t: "CANCI√ìN 04", id: "19m1LM3kBC15iK6_vFFIRf0Ce2qNU4yLc", n: [] },
            { t: "CANCI√ìN 05", id: "1DimDd61FQBItp8b8pHoDFQSHciCpkHf5", n: [] },
            { t: "CANCI√ìN 06", id: "1BoAzgevTIKL7iia7V8OBU8263uqZSqf6", n: [] },
            { t: "CANCI√ìN 07", id: "1nXzpzM29P8b6i2dDCe3pY7-7nNfdQU5C", n: [] },
            { t: "CANCI√ìN 08", id: "1VfmkjE6h1wuvTVXfTotfFqae5kL8l6iF", n: [] },
            { t: "CANCI√ìN 09", id: "1p5TC1f085zcYb5QDJqBAkBeCtjorW46v", n: [] },
            { t: "CANCI√ìN 10", id: "1P1Op6CfoFi2P8hu53ifKXaVCdJhaHGk_", n: [] },
            { t: "CANCI√ìN 11", id: "1rgwhqQyNFqo9KyRw9dfAbi01jCXsdFNT", n: [] },
            { t: "CANCI√ìN 12", id: "1GoeBjx14wwuVNCKsLm8cAEV_5CnxoKNQ", n: [] },
            { t: "CANCI√ìN 13", id: "1TTySzZ94C7VTSOG5-2dPboLyrp6kiblu", n: [] },
            { t: "CANCI√ìN 14", id: "111nC3rJ-0XOSYoBKwm9hGZ2LuQoNP4H9", n: [] },
            { t: "CANCI√ìN 15", id: "1xmOwy8WUiTeHEHmHNUeEzaDc0GvsXlbi", n: [] },
            { t: "CANCI√ìN 16", id: "1f-xOJJrOYDVYjrAI-XqWTAF87VFAC3yJ", n: [] },
            { t: "CANCI√ìN 17", id: "1MhZDVIhHlFtzBAlcfoucvhl0D0qxTSmW", n: [] },
            { t: "CANCI√ìN 18", id: "1OWF15aoncxIolHDyKvpRmjrZCgc23jNE", n: [] },
            { t: "CANCI√ìN 19", id: "1JI-ZIuy-Y10HS9f11JDLEf1ODTxSyRSr", n: [] },
            { t: "CANCI√ìN 20", id: "1M4EgHn2Pxo2I6TePFi8d9pMXw_iguIjE", n: [] }
        ];

        let fase = "clasificacion";
        let participantes = [];
        let ganadores = [];
        let dueloActual = 0;

        function render() {
            const lista = document.getElementById('playlist');
            const nJurados = document.getElementById('viewer-count').value;
            lista.innerHTML = '';

            if (fase === "clasificacion") {
                canciones.forEach((s, i) => {
                    const media = s.n.length > 0 ? (s.n.reduce((a,b)=>a+b,0)/s.n.length).toFixed(1) : "0.0";
                    let inputs = '';
                    for(let j=0; j<nJurados; j++) inputs += `<input type="number" step="0.1" class="score-input j-${i}" placeholder="J${j+1}">`;
                    
                    lista.innerHTML += `
                        <div class="song-card">
                            <div class="song-title" onclick="play('${s.id}','${s.t}')">‚ñ∂ ${s.t} <span class="avg-score">[${media}]</span></div>
                            <div class="vote-grid">${inputs}</div>
                            <button class="phase-btn" onclick="votar(${i})">GUARDAR NOTAS</button>
                        </div>`;
                });
            }
        }

        function votar(i) {
            document.querySelectorAll(`.j-${i}`).forEach(inp => {
                if(inp.value !== "") canciones[i].n.push(parseFloat(inp.value));
                inp.value = "";
            });
            render();
        }

        function cerrarClasificacion() {
            participantes = [...canciones]
                .map(s => ({...s, m: s.n.length > 0 ? s.n.reduce((a,b)=>a+b,0)/s.n.length : 0}))
                .sort((a,b) => b.m - a.m).slice(0, 8);
            
            if(participantes.length < 8) return alert("¬°Necesitas puntuar al menos 8 canciones!");
            
            fase = "cuartos";
            dueloActual = 0;
            document.getElementById('next-phase-btn').style.display = "none";
            renderDuelo();
        }

        function renderDuelo() {
            const lista = document.getElementById('playlist');
            const numDuelos = participantes.length / 2;
            document.getElementById('fase-nombre').innerText = `${fase.toUpperCase()} - DUELO ${dueloActual + 1}/${numDuelos}`;
            
            const c1 = participantes[dueloActual * 2];
            const c2 = participantes[dueloActual * 2 + 1];

            lista.innerHTML = `
                <div class="vs-container">
                    <div class="vs-card" onclick="play('${c1.id}','${c1.t}')">
                        <div class="song-title">${c1.t}</div>
                        <input type="number" id="vA" class="score-input" placeholder="Puntos A" style="margin-top:10px">
                    </div>
                    <div class="vs-divider">VS</div>
                    <div class="vs-card" onclick="play('${c2.id}','${c2.t}')">
                        <div class="song-title">${c2.t}</div>
                        <input type="number" id="vB" class="score-input" placeholder="Puntos B" style="margin-top:10px">
                    </div>
                    <button class="phase-btn" onclick="resolverDuelo()">FINALIZAR DUELO</button>
                </div>`;
        }

        function resolverDuelo() {
            const vA = parseFloat(document.getElementById('vA').value) || 0;
            const vB = parseFloat(document.getElementById('vB').value) || 0;
            ganadores.push(vA >= vB ? participantes[dueloActual * 2] : participantes[dueloActual * 2 + 1]);
            
            dueloActual++;
            if (dueloActual < participantes.length / 2) renderDuelo();
            else siguienteFase();
        }

        function siguienteFase() {
            participantes = [...ganadores];
            ganadores = [];
            dueloActual = 0;
            if (participantes.length === 4) { fase = "semifinales"; renderDuelo(); }
            else if (participantes.length === 2) { fase = "final"; renderDuelo(); }
            else {
                document.getElementById('fase-nombre').innerText = "GANADOR FINAL";
                document.getElementById('playlist').innerHTML = `<h1 style="color:#1DB954; text-align:center">üèÜ ${participantes[0].t} üèÜ</h1>`;
                play(participantes[0].id, participantes[0].t);
            }
        }

        function play(id, t) {
            document.getElementById('video-container').innerHTML = `<iframe src="https://drive.google.com/file/d/${id}/preview"></iframe>`;
            document.getElementById('current-song').innerText = "SONANDO: " + t;
        }

        function actualizarJurados() { if(fase === "clasificacion") render(); }
        render();
    </script>
</body>
</html>